import{o as e,c as a,a as t,k as o,aa as s,h as i,m as r,s as n,t as l,p as c,q as u,B as d,x as p,E as g,d as m,r as f,l as _,N as h,n as v,al as b,aw as w,a7 as y,L as k,a8 as D,ax as I,ay as x,y as z,z as $,S}from"./vendor.cc2bbcc0.js";import{r as C,P as E,I as M,a as A,i as H,b as T,c as U,s as V,d as O,_ as G,e as L,D as N,g as R,f as P,h as F,u as B,j,k as q,l as X,m as K,n as Z,o as W,p as J}from"./index.06f46b46.js";const Q={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Y=[t("path",{fill:"currentColor",d:"M640 384v64H448a128 128 0 0 0-128 128v128a128 128 0 0 0 128 128h320a128 128 0 0 0 128-128V576a128 128 0 0 0-64-110.848V394.88c74.56 26.368 128 97.472 128 181.056v128a192 192 0 0 1-192 192H448a192 192 0 0 1-192-192V576a192 192 0 0 1 192-192z"},null,-1),t("path",{fill:"currentColor",d:"M384 640v-64h192a128 128 0 0 0 128-128V320a128 128 0 0 0-128-128H256a128 128 0 0 0-128 128v128a128 128 0 0 0 64 110.848v70.272A192.064 192.064 0 0 1 64 448V320a192 192 0 0 1 192-192h320a192 192 0 0 1 192 192v128a192 192 0 0 1-192 192z"},null,-1)];var ee={name:"ep-connection",render:function(t,o){return e(),a("svg",Q,[...Y])}};const ae={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},te=[t("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384a192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512a256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"},null,-1)];var oe={name:"ep-user",render:function(t,o){return e(),a("svg",ae,[...te])}};const se={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ie=[t("path",{fill:"currentColor",d:"M118.656 438.656a32 32 0 0 1 0-45.248L416 96l4.48-3.776A32 32 0 0 1 461.248 96l3.712 4.48a32.064 32.064 0 0 1-3.712 40.832L218.56 384H928a32 32 0 1 1 0 64H141.248a32 32 0 0 1-22.592-9.344M64 608a32 32 0 0 1 32-32h786.752a32 32 0 0 1 22.656 54.592L608 928l-4.48 3.776a32.064 32.064 0 0 1-40.832-49.024L805.632 640H96a32 32 0 0 1-32-32"},null,-1)];var re={name:"ep-switch",render:function(t,o){return e(),a("svg",se,[...ie])}};const ne={key:0},le={key:0},ce={key:1},ue={key:1};var de=G(o({__name:"authorization-status-bar",setup(o){const g=s({IEpCheck:T,IEpClose:U,IEpSwitch:re}),{token:m,isAutoAuthorize:f,installed:_}=i((()=>V.getters.getGitHubAuthorizationInfo)).value,h=()=>{O.push({path:"/login",query:{jump:"0"}})};return(o,s)=>{const i=r;return e(),a("div",{class:d(["authorization-status-box status-bar",{success:n(f)&&n(m)&&!n(H)(),warning:n(f)&&n(m)&&!n(H)()&&!1===n(_),error:n(f)&&n(m)&&n(H)()}])},[t("div",null,[n(f)?(e(),a("span",ne,[n(H)()?(e(),a("span",le,l(o.$t("authorization.text_4")),1)):(e(),a("span",ce,l(o.$t("authorization.text_3")),1))])):(e(),a("span",ue,l(o.$t("authorization.text_5")),1))]),c(i,{text:"",type:"primary",icon:g.value.IEpSwitch,onClick:h},{default:u((()=>[p(l(o.$t("authorization.text_7")),1)])),_:1},8,["icon"])],2)}}}),[["__scopeId","data-v-64cb0c6c"]]);const pe=i((()=>V.getters.getUserConfigInfo)).value,ge=async()=>{await V.dispatch("USER_CONFIG_INFO_PERSIST")};const me=async e=>{const{selectedDir:a,dirMode:t}=pe;let o=L.global.t("config_page.message_6");if(""===a){switch(t){case N.newDir:o=L.global.t("config_page.message_7"),null==e||e.focus();break;case N.repoDir:o=L.global.t("config_page.message_8")}g.warning({message:o})}else await O.push("/upload")},fe=async e=>{const{token:a}=pe;if(!a)return g.error({message:L.global.t("config_page.message_1")}),void(null==e||e.focus());const t=m.service({lock:!0,text:L.global.t("config_page.loading_6")});try{const e=await R(pe.token);if(!e)return t.close(),void g.error({message:L.global.t("config_page.message_2")});V.getters.getGitHubAuthorizationInfo.isAutoAuthorize||await V.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{manualToken:pe.token}),await async function(e){await V.dispatch("SET_USER_CONFIG_INFO",{logined:!0,id:e.id,owner:e.login,name:e.name,email:e.email,avatarUrl:e.avatar_url})}(e);let a=!1;const r=await(o=pe.owner,s=M,C({url:`/repos/${o}/${s}`,method:"GET",noCache:!0,success422:!0,noShowErrMsg:!0}));r&&(a=!0,await V.dispatch("SET_USER_CONFIG_INFO",{repoPrivate:r.private}));const n=await(e=>C({url:"/user/repos",method:"POST",data:{name:M,description:A,private:!1},headers:{Authorization:`Bearer ${e}`},success422:!0,noShowErrMsg:!0}))(pe.token),l=i((()=>V.getters.getGitHubAuthorizationInfo)).value,{token:c,authorized:u}=l;if(await(async(e,a,t)=>{var o;if(a&&t)if(e)await V.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{installed:!0});else{const e=g({customClass:"custom-message-container",duration:0,offset:20,type:"warning",message:`<div class="content-box authorization">\n                    <span class="msg">${L.global.t("authorization.msg_2")}</span>\n                    <spna class="btn-box">\n                      <span class="confirm btn">${L.global.t("authorization.btn_1")}</span>\n                    </spna>\n                  </div>`,dangerouslyUseHTMLString:!0});null==(o=document.querySelector(".custom-message-container .authorization .confirm"))||o.addEventListener("click",(()=>{e.close();let a="https://github.com/apps/picx-app/installations/select_target";pe.id&&(a="https://github.com/apps/picx-app/installations/new/permissions?target_id="+pe.id),window.location.href=a}))}})(n,u,c),!n)return t.close(),void(u&&c||g.error({message:L.global.t("config_page.message_3")}));pe.repo=M,pe.branch=P,a&&(pe.dirList=await F(pe)),pe.dirMode=N.rootDir,pe.selectedDir="/",a||await(async e=>{const{owner:a,repo:t,branch:o}=e;await C({url:`/repos/${a}/${t}/contents/README.md`,method:"PUT",data:{message:E,branch:o,content:window.btoa("\n# Welcome to use PicX\n\n[PicX](https://github.com/XPoet/picx) is a simple and powerful image hosting tool. It supports image hosting services via GitHub repository.\n\nPicX is completely open source, and you can use it for free.\n\nIf you like it, please give it a star on [GitHub](https://github.com/XPoet/picx).\n        ")},noShowErrMsg:!0})})(pe),await ge(),t.close(),g.success({message:L.global.t("config_page.message_4")}),await O.push("/upload")}catch(r){g.error({message:L.global.t("config_page.message_5")}),console.error("oneClickAutoConfig >> ",r)}var o,s};const _e={class:"page-container config-page-container"},he={class:"row-item token"},ve={class:"cell-item"},be={class:"cell-item"},we={class:"repo-descriptions-item"},ye={class:"cell-item"},ke={class:"dir-box border-box"},De={key:2,class:"dir-item"};var Ie=G(o({__name:"picx-config",setup(o){const s=B(),d=f(32),g=i((()=>s.getters.getUserConfigInfo)).value,C=i((()=>s.getters.getGlobalSettings)).value,E=f(null),M=f(null),A=f("repoDirCascaderKey"),T=e=>{var a;switch(e){case N.rootDir:g.selectedDir="/";break;case N.dateDir:g.selectedDir=X("yyyyMMdd");break;case N.newDir:g.selectedDirList.length?g.selectedDir=g.selectedDirList.join("/"):g.selectedDir="xxx",null==(a=E.value)||a.focus();break;case N.repoDir:g.selectedDir="",g.selectedDirList.length&&(g.selectedDir=g.selectedDirList.join("/"));break;default:g.selectedDir="/"}ge()},U=async()=>{const e=m.service({lock:!0,text:L.global.t("config_page.loading_4")});g.dirList=await F(g),e.close(),await s.dispatch("USER_CONFIG_INFO_PERSIST")};return _((()=>{setTimeout((()=>{var e;g.token&&"1"!==O.currentRoute.value.query.focus||null==(e=M.value)||e.focus(),(()=>{const{token:e,isAutoAuthorize:a}=i((()=>s.getters.getGitHubAuthorizationInfo)).value;a&&e&&!H()&&O.currentRoute.value.query.auto&&fe(M.value)})()}),100)})),(o,s)=>{const i=de,m=h,f=r,_=oe,H=v,V=b,O=w,G=ee,L=K,R=Z,P=y,F=k,B=D,X=W,Q=J,Y=I;return e(),a("div",_e,[c(i,{class:"row-item"}),t("div",he,[c(m,{ref_key:"tokenInputRef",ref:M,modelValue:n(g).token,"onUpdate:modelValue":s[0]||(s[0]=e=>n(g).token=e),clearable:"",autofocus:!n(g).token,"show-password":"",placeholder:o.$t("config_page.input_token"),onKeydown:s[1]||(s[1]=x((e=>n(fe)(M.value)),["enter"]))},null,8,["modelValue","autofocus","placeholder"]),c(f,{plain:"",type:"primary",onClick:s[2]||(s[2]=e=>n(fe)(M.value))},{default:u((()=>[p(l(o.$t("config_page.one_click_config")),1)])),_:1})]),n(g).token?(e(),z(Y,{key:0,class:"row-item",column:2,border:""},{default:u((()=>[n(g).owner?(e(),z(O,{key:0},{label:u((()=>[t("div",ve,[c(H,null,{default:u((()=>[c(_)])),_:1}),p(" "+l(o.$t("username")),1)])])),default:u((()=>[c(V,{type:"primary",href:n(j)(n(g)),target:"_blank"},{default:u((()=>[p(l(n(g).owner),1)])),_:1},8,["href"])])),_:1})):$("",!0),n(g).repo?(e(),z(O,{key:1},{label:u((()=>[t("div",be,[c(H,null,{default:u((()=>[c(G)])),_:1}),p(" "+l(o.$t("repo")),1)])])),default:u((()=>[t("div",we,[c(V,{type:"primary",href:n(q)(n(g)),target:"_blank"},{default:u((()=>[p(l(n(g).repo),1)])),_:1},8,["href"]),c(L)])])),_:1})):$("",!0),n(g).repo&&n(g).branch?(e(),z(O,{key:2,span:2},{label:u((()=>[t("div",ye,[c(H,null,{default:u((()=>[c(R)])),_:1}),p(" "+l(o.$t("dir")),1)])])),default:u((()=>[t("div",ke,[c(B,{class:"dir-item",modelValue:n(g).dirMode,"onUpdate:modelValue":s[3]||(s[3]=e=>n(g).dirMode=e),onChange:T},{default:u((()=>[c(P,{label:"rootDir"},{default:u((()=>[p(l(o.$t("config_page.root_dir")),1)])),_:1}),c(F,{content:o.$t("config_page.date_dir_tip"),placement:"top",offset:0},{default:u((()=>[c(P,{label:"dateDir"},{default:u((()=>[p(l(o.$t("config_page.date_dir")),1)])),_:1})])),_:1},8,["content"]),n(g).dirList.length?(e(),z(P,{key:0,label:"repoDir"},{default:u((()=>[p(l(o.$t("config_page.repo_dir")),1)])),_:1})):$("",!0),c(F,{content:o.$t("config_page.input_new_dir"),placement:"top",offset:0},{default:u((()=>[c(P,{label:"newDir"},{default:u((()=>[p(l(o.$t("config_page.create_new_dir")),1)])),_:1})])),_:1},8,["content"])])),_:1},8,["modelValue"]),n(g).dirMode===n(N).rootDir||n(g).dirMode===n(N).dateDir?(e(),z(m,{key:0,class:"dir-item",modelValue:n(g).selectedDir,"onUpdate:modelValue":s[4]||(s[4]=e=>n(g).selectedDir=e),readonly:""},null,8,["modelValue"])):$("",!0),n(g).dirMode===n(N).newDir?(e(),z(m,{key:1,class:"dir-item",ref_key:"newDirInputRef",ref:E,modelValue:n(g).selectedDir,"onUpdate:modelValue":s[5]||(s[5]=e=>n(g).selectedDir=e),onInput:s[6]||(s[6]=e=>n(ge)()),clearable:"",placeholder:o.$t("config_page.placeholder_4")},null,8,["modelValue","placeholder"])):$("",!0),n(g).dirMode===n(N).repoDir?(e(),a("div",De,[c(X,{"el-key":A.value,"el-size":n(C).elementPlusSize,"el-clearable":!0,style:S({width:"calc(100% - "+d.value+"rem)"})},null,8,["el-key","el-size","style"]),c(H,{class:"refresh-icon",style:S({width:d.value+"rem"}),onClick:U},{default:u((()=>[c(Q)])),_:1},8,["style"])])):$("",!0)])])),_:1})):$("",!0)])),_:1})):$("",!0),n(g).token&&n(g).repo&&n(g).branch?(e(),z(f,{key:1,class:"row-item confirm-btn",plain:"",type:"primary",onClick:s[7]||(s[7]=e=>n(me)(E.value))},{default:u((()=>[p(l(o.$t("confirm")),1)])),_:1})):$("",!0)])}}}),[["__scopeId","data-v-87d76082"]]);export{Ie as default};
